<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arix Signature Tree</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "three": "https://esm.sh/three@0.150.0",
        "@react-three/fiber": "https://esm.sh/@react-three/fiber@8.12.0",
        "@react-three/drei": "https://esm.sh/@react-three/drei@9.57.0",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>
    <style>
        body { margin: 0; background-color: #020617; overflow: hidden; color: white; }
        #root { width: 100vw; height: 100vh; }
        .font-cinzel { font-family: 'Cinzel', serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useRef, useMemo, useState } from 'react';
        import ReactDOM from 'react-dom';
        import * as THREE from 'three';
        import { Canvas, useFrame } from '@react-three/fiber';
        import { OrbitControls, Stars, Float, Text, MeshDistortMaterial, PresentationControls } from '@react-three/drei';

        // 1. 圣诞树层级组件 (还原你原始的几何逻辑)
        const TreeLayer = ({ position, scale, color, delay }) => {
            const meshRef = useRef();
            useFrame((state) => {
                const time = state.clock.getElapsedTime();
                meshRef.current.position.y = position[1] + Math.sin(time + delay) * 0.1;
            });

            return (
                <mesh ref={meshRef} position={position} scale={scale}>
                    <coneGeometry args={[1, 1.4, 8]} />
                    <meshStandardMaterial 
                        color={color} 
                        flatShading 
                        roughness={0.3}
                        metalness={0.2}
                    />
                </mesh>
            );
        };

        // 2. 圣诞树整体
        function SignatureTree() {
            return (
                <group>
                    {/* 树干 */}
                    <mesh position={[0, -1.8, 0]}>
                        <cylinderGeometry args={[0.2, 0.3, 1, 8]} />
                        <meshStandardMaterial color="#2d1a12" />
                    </mesh>

                    {/* 四层树叶 */}
                    <TreeLayer position={[0, -0.8, 0]} scale={[1.8, 1.2, 1.8]} color="#064e3b" delay={0} />
                    <TreeLayer position={[0, 0.1, 0]} scale={[1.4, 1.1, 1.4]} color="#065f46" delay={0.5} />
                    <TreeLayer position={[0, 0.9, 0]} scale={[1, 1, 1]} color="#059669" delay={1} />
                    <TreeLayer position={[0, 1.6, 0]} scale={[0.6, 0.8, 0.6]} color="#10b981" delay={1.5} />

                    {/* 顶部的发光星 */}
                    <Float speed={4} rotationIntensity={1} floatIntensity={2}>
                        <mesh position={[0, 2.2, 0]}>
                            <sphereGeometry args={[0.15, 16, 16]} />
                            <meshStandardMaterial 
                                color="#facc15" 
                                emissive="#fbbf24" 
                                emissiveIntensity={2} 
                            />
                            <pointLight color="#facc15" intensity={1} distance={5} />
                        </mesh>
                    </Float>
                </group>
            );
        }

        // 3. 雪花系统
        function Snow() {
            const count = 400;
            const mesh = useRef();
            const dummy = useMemo(() => new THREE.Object3D(), []);
            const particles = useMemo(() => {
                const temp = [];
                for (let i = 0; i < count; i++) {
                    const t = Math.random() * 100;
                    const factor = 20 + Math.random() * 100;
                    const speed = 0.01 + Math.random() / 200;
                    const xFactor = -50 + Math.random() * 100;
                    const yFactor = -50 + Math.random() * 100;
                    const zFactor = -50 + Math.random() * 100;
                    temp.push({ t, factor, speed, xFactor, yFactor, zFactor, mx: 0, my: 0 });
                }
                return temp;
            }, [count]);

            useFrame((state) => {
                particles.forEach((particle, i) => {
                    let { t, factor, speed, xFactor, yFactor, zFactor } = particle;
                    t = particle.t += speed / 2;
                    const a = Math.cos(t) + Math.sin(t * 1) / 10;
                    const b = Math.sin(t) + Math.cos(t * 2) / 10;
                    const s = Math.cos(t);
                    dummy.position.set(
                        (xFactor + Math.cos(t) * factor) / 10,
                        (yFactor + Math.sin(t) * factor) / 10,
                        (zFactor + Math.cos(t) * factor) / 10
                    );
                    dummy.scale.set(s, s, s);
                    dummy.updateMatrix();
                    mesh.current.setMatrixAt(i, dummy.matrix);
                });
                mesh.current.instanceMatrix.needsUpdate = true;
            });

            return (
                <instancedMesh ref={mesh} args={[null, null, count]}>
                    <sphereGeometry args={[0.05, 8, 8]} />
                    <meshBasicMaterial color="#ffffff" transparent opacity={0.6} />
                </instancedMesh>
            );
        }

        // 4. 主页面
        function App() {
            return (
                <div className="relative w-full h-full bg-slate-950">
                    {/* UI 文字层层 */}
                    <div className="absolute top-12 left-12 z-10 pointer-events-none">
                        <h1 className="font-cinzel text-5xl font-bold tracking-tighter text-white/90">
                            ARIX<br/><span className="text-emerald-500">SIGNATURE</span>
                        </h1>
                        <p className="mt-4 text-slate-400 font-light tracking-widest uppercase text-xs">
                            Premium Digital Collectible // 2025
                        </p>
                    </div>

                    <div className="absolute bottom-12 right-12 z-10 text-right pointer-events-none">
                        <div className="text-emerald-500/50 text-xs font-mono mb-2">SYSTEM_ID: 025-XMAS</div>
                        <p className="font-cinzel text-xl text-white/70 italic">Merry Christmas</p>
                    </div>

                    {/* 3D 渲染层 */}
                    <Canvas camera={{ position: [0, 0, 8], fov: 40 }}>
                        <fog attach="fog" args={['#020617', 5, 20]} />
                        <ambientLight intensity={0.2} />
                        <pointLight position={[10, 10, 10]} intensity={1} />
                        <spotLight position={[-10, 10, 10]} angle={0.15} penumbra={1} intensity={1} castShadow />
                        
                        <Stars radius={100} depth={50} count={5000} factor={4} saturation={0} fade speed={1} />
                        <Snow />

                        <PresentationControls
                            global
                            config={{ mass: 2, tension: 500 }}
                            snap={{ mass: 4, tension: 1500 }}
                            rotation={[0, 0.3, 0]}
                            polar={[-Math.PI / 3, Math.PI / 3]}
                            azimuth={[-Math.PI / 1.4, Math.PI / 1.4]}
                        >
                            <Float speed={1} rotationIntensity={0.2} floatIntensity={0.5}>
                                <SignatureTree />
                            </Float>
                        </PresentationControls>

                        <OrbitControls enableZoom={false} enablePan={false} />
                    </Canvas>
                </div>
            );
        }

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
